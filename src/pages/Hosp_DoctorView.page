<apex:page id="Hosp_DoctorView" standardController="Doctor__c" extensions="Hosp_DoctorViewControllerExtension" >

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"/>

    <style>
            label, input { display:block; }
            input.text { margin-bottom:12px; width:95%; padding: .4em; }
            fieldset { padding:0; border:0; margin-top:25px; }
            h1 { font-size: 1.2em; margin: .6em 0; }
            div#users-contain { width: 350px; margin: 20px 0; }
            div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
            div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
            .ui-dialog .ui-state-error { padding: .3em; }
            .validateTips { border: 1px solid transparent; padding: 0.3em; }
            .datePicker { z-index: 200 }
    </style>

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <apex:pageBlock title="{! $Label.Doctor }" mode="edit">
        <apex:messages/>

        <script language="JavaScript">
            function copyToClipboard(elementId) {
                var aux = document.createElement("input");
                aux.setAttribute("value", document.getElementById(elementId).innerHTML);
                document.body.appendChild(aux);
                aux.select();
                document.execCommand("copy");
                document.body.removeChild(aux);
            }

        </script>

        <apex:pageBlockSection title="{! $Label.Basic_Info}" columns="2">
            <apex:outputField value="{! Doctor__c.FirstName__c }"/>
            <apex:outputField value="{! Doctor__c.Email__c }"/>
            <apex:outputField value="{! Doctor__c.Name }"/>

            <apex:pageBlockSectionItem>
                <apex:outputText value="{! $ObjectType.Doctor__c.fields.Phone__c.Label }"/>
                <apex:form>
                    <apex:pageBlockSectionItem>
                        <apex:outputField id="copytext" value="{! Doctor__c.Phone__c }"/>

                        <apex:commandButton onClick="copyToClipboard('{! $Component.copytext}');" reRender="copytext"
                                            value="{! $Label.Copy_Label }"/>

                    </apex:pageBlockSectionItem>
                </apex:form>
            </apex:pageBlockSectionItem>

        </apex:pageBlockSection>

        <apex:pageBlockSection title="{! $Label.Address }" columns="2">
            <apex:outputField value="{! Doctor__c.City__c }"/>
            <apex:outputField value="{! Doctor__c.Country__c }"/>
            <apex:outputField value="{! Doctor__c.Street__c }"/>
        </apex:pageBlockSection>

        <div align="center">
            <apex:form>
                <apex:commandButton action="{! edit }" value="{! $Label.Edit }" />

                <apex:commandButton id="opener"
                                    onclick="showHireDialog('{! firstLastName }'); return false;"
                                    value="{! $Label.Hire }"
                                    reRender="none"/>

                <apex:commandButton action="{! delete }" value="{! $Label.Delete }"
                                    onclick="if(!confirm('{! $Label.Are_you_sure }')){ return false };"/>

                <apex:commandLink action="{! expToPdf }" target="_blank" style="text-decoration: none">
                    <apex:commandButton value="{! $Label.Export_To_PDF }"/>
                </apex:commandLink>

                <apex:actionFunction name="getFirstLastName" action="{! hire }" onComplete="showHireDialog({! firstLastName })">
                </apex:actionFunction>

            </apex:form>
        </div>

        <apex:pageBlockSection title="{! $Label.Tracking_history }" columns="1">
            <apex:relatedList list="Histories"/>
        </apex:pageBlockSection>

        <apex:pageBlockSection title="{! $Label.Contracts }" id="contracts_list" columns="1">
            <apex:pageBlockTable value="{! contracts }" var="contr" columns="5" columnsWidth="10%,30%,30%,15%, 15%">

                <apex:column headerValue="{! $Label.Actions }">
                    <apex:form>
                        <apex:commandLink action="{! dismiss }" reRender="contracts_list" style="text-decoration:none">
                            <apex:param name="contractId" value="{! contr.Id }" assignTo="{! contractId }"/>
                            <apex:commandButton value="{! $Label.Dismiss }" rendered="{! if(contr.EndDate__c <= TODAY(), 'false', 'true') }"/>
                        </apex:commandLink>
                    </apex:form>
                </apex:column>

                <apex:column headerValue="{! $ObjectType.Doctor__c.fields.FirstLastName__c.label }"
                             value="{! contr.Doctor__r.FirstLastName__c }"/>
                <apex:column headerValue="{! $ObjectType.Hospital__c.fields.Name.label }" value="{! contr.Hospital__r.Name }"/>
                <apex:column headerValue="{! $ObjectType.Contract__c.fields.StartDate__c.label }" value="{! contr.StartDate__c}"/>
                <apex:column headerValue="{! $ObjectType.Contract__c.fields.EndDate__c.label }" value="{! contr.EndDate__c}"/>

            </apex:pageBlockTable>
        </apex:pageBlockSection>

    </apex:pageBlock>

    <div id="myModal" style="display: none">
        <c:Hosp_HireDoctorComponent doctorId="{! Doctor__c.Id }"/>
    </div>

    <script>
        function showHireDialog(name) {
            $("#myModal").dialog({
                resizable: true,
                autoOpen: false,
                height:600,
                width: 600,
                modal: true,
                title: "Hire " + name
            });
            $("#myModal").dialog("open");
        }
    </script>

</apex:page>