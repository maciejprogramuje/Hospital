<apex:page id="Hosp_DoctorView" standardController="Doctor__c" extensions="Hosp_DoctorViewControllerExtension" renderAs="{! renderingService }">

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"/>

    <head>
        <style>
            .datePicker { z-index: 200 }
            .column { float: left; width: 25%; }
            .content { width: 75%; }
        </style>
    </head>


    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <apex:pageBlock id='wholeDoctorView' title="{! $Label.Doctor }" mode="edit">
        <apex:messages/>

        <script language="JavaScript">
            function copyToClipboard(elementId) {
                var aux = document.createElement("input");
                aux.setAttribute("value", document.getElementById(elementId).innerHTML);
                document.body.appendChild(aux);
                aux.select();
                document.execCommand("copy");
                document.body.removeChild(aux);
            }

            var w;
            function ChangeProfile_picture()
            {
                var windowWidth = document.documentElement.clientWidth;
                var windowHeight = document.documentElement.clientHeight;
                w = window.open('/apex/Hosp_DoctorProfileImage','ProfilePicture','channelmode=0,directories=0,fullscreen=0,height=190,width=453,left='+(windowWidth/2-453/2)+',top='+(windowHeight/2-190/2)+',location=0,menubar=0,resizable=0,scrollbars=0,status=0,titlebar=0,toolbar=0');
            }

            function updateURL(DocId)
            {
                var imgTag =  document.getElementById('imgval');
                imgTag.src = "/servlet/servlet.FileDownload?file="+DocId;
                w.close();
            }

        </script>

        <div>
            <div class="column">
                <apex:image width="200" value="{! URLFOR($Action.Attachment.Download, avatarSrc.Id)}" id="doctorCustomAvatar" rendered="{! hasAvatar }"/>
                <apex:image width="200" value="{! $Resource.man}" id="doctorDefaultAvatar" rendered="{! NOT(hasAvatar) }"/>

                <apex:form>
                    <apex:commandButton value="{! $Label.Upload}" action="{! changeRecordPicture }" rendered="{! renderingService != 'PDF' }"/>
                    <apex:commandButton value="{! $Label.Delete}" action="{! changeRecordPictureToDefault }" rendered="{! renderingService != 'PDF' }" reRender="wholeDoctorView"/>
                </apex:form>
            </div>

            <div class="column content">
                <apex:pageBlockSection title="{! $Label.Basic_Info}" columns="2">
                    <apex:outputField value="{! Doctor__c.FirstName__c }"/>
                    <apex:outputField value="{! Doctor__c.Email__c }"/>
                    <apex:outputField value="{! Doctor__c.Name }"/>

                    <apex:pageBlockSectionItem>
                        <apex:outputText value="{! $ObjectType.Doctor__c.fields.Phone__c.Label }"/>
                        <apex:form>
                            <apex:pageBlockSectionItem>
                                <apex:outputField id="copytext" value="{! Doctor__c.Phone__c }"/>

                                <apex:commandButton rendered="{! renderingService != 'PDF' }"
                                                    onClick="copyToClipboard('{! $Component.copytext}');" reRender="copytext"
                                                    value="{! $Label.Copy_Label }"/>

                            </apex:pageBlockSectionItem>
                        </apex:form>
                    </apex:pageBlockSectionItem>
                </apex:pageBlockSection>

                <apex:pageBlockSection title="{! $Label.Address }" columns="2">
                    <apex:outputField value="{! Doctor__c.City__c }"/>
                    <apex:outputField value="{! Doctor__c.Country__c }"/>
                    <apex:outputField value="{! Doctor__c.Street__c }"/>
                </apex:pageBlockSection>
            </div>
            <div style="clear: both"></div>
        </div>



        <div align="center">
            <apex:form rendered="{! renderingService != 'PDF' }">
                <apex:commandButton action="{! edit }" value="{! $Label.Edit }" />

                <apex:commandButton id="opener"
                                    onclick="showHireDialog('{! firstLastName }'); return false;"
                                    value="{! $Label.Hire }"
                                    reRender="none"/>

                <apex:commandButton action="{! delete }" value="{! $Label.Delete }"
                                    onclick="if(!confirm('{! $Label.Are_you_sure }')){ return false };"/>

                <apex:commandLink action="{! expToPdf }" target="_blank" style="text-decoration: none">
                    <apex:commandButton value="{! $Label.Export_To_PDF }"/>`
                </apex:commandLink>

                <apex:actionFunction name="getFirstLastName" onComplete="showHireDialog({! firstLastName })">
                </apex:actionFunction>

            </apex:form>
        </div>

        <apex:pageBlockSection title="{! $Label.Tracking_history }" columns="1">
            <apex:relatedList list="Histories"/>
        </apex:pageBlockSection>

        <apex:pageBlockSection title="{! $Label.Contracts }" id="contracts_list" columns="1">
            <apex:pageBlockTable value="{! contracts }" var="contr" columns="5" columnsWidth="10%,30%,30%,15%, 15%">

                <apex:column headerValue="{! $Label.Actions }">
                    <apex:form rendered="{! renderingService != 'PDF' }">
                        <apex:commandLink action="{! dismiss }" reRender="contracts_list" style="text-decoration:none">
                            <apex:param name="contractId" value="{! contr.Id }" assignTo="{! contractId }"/>
                            <apex:commandButton value="{! $Label.Dismiss }" rendered="{! if(contr.EndDate__c <= TODAY(), 'false', 'true') }"/>
                        </apex:commandLink>
                    </apex:form>
                </apex:column>

                <apex:column headerValue="{! $ObjectType.Doctor__c.fields.FirstLastName__c.label }"
                             value="{! contr.Doctor__r.FirstLastName__c }"/>
                <apex:column headerValue="{! $ObjectType.Hospital__c.fields.Name.label }" value="{! contr.Hospital__r.Name }"/>
                <apex:column headerValue="{! $ObjectType.Contract__c.fields.StartDate__c.label }" value="{! contr.StartDate__c}"/>
                <apex:column headerValue="{! $ObjectType.Contract__c.fields.EndDate__c.label }" value="{! contr.EndDate__c}"/>

            </apex:pageBlockTable>
        </apex:pageBlockSection>

    </apex:pageBlock>

    <div id="myModal" style="display: none">
        <c:Hosp_HireDoctorComponent doctorId="{! Doctor__c.Id }"/>
    </div>

    <script>
        function showHireDialog(name) {
            $("#myModal").dialog({
                resizable: true,
                autoOpen: false,
                height:600,
                width: 600,
                modal: true,
                title: "Hire " + name
            });
            $("#myModal").dialog("open");
        }
    </script>

</apex:page>